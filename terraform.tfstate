{
  "version": 4,
  "terraform_version": "1.9.8",
  "serial": 18,
  "lineage": "7a026ac8-7d08-a875-99fc-312add756a7d",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_download_file",
      "name": "ubuntu_cloud_image",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "checksum": null,
            "checksum_algorithm": null,
            "content_type": "iso",
            "datastore_id": "local",
            "decompression_algorithm": null,
            "file_name": "jammy-server-cloudimg-amd64.img",
            "id": "local:iso/jammy-server-cloudimg-amd64.img",
            "node_name": "node2",
            "overwrite": true,
            "overwrite_unmanaged": false,
            "size": 653668352,
            "upload_timeout": 600,
            "url": "https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img",
            "verify": true
          },
          "sensitive_attributes": [],
          "private": "eyJvcmlnaW5hbF9zdGF0ZV9zaXplIjoiTmpVek5qWTRNelV5IiwidXJsX3NpemUiOiJOalV6TmpZNE16VXkifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "cloud_config",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "cloud-config-master.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/cloud-config-master.yaml",
            "node_name": "node2",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\r\nchpasswd:\r\n  list: |\r\n    ubuntu:password\r\n  expire: false\r\nhostname: master_node\r\npackages:\r\n  - qemu-guest-agent\r\n  - openssh-server\r\nusers:\r\n  - default\r\n  - name: ubuntu\r\n    groups: sudo\r\n    shell: /bin/bash\r\n    ssh-authorized-keys:\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDPGGEn2DJJIYmHwEyNaytWGaBsXIHZtOTjev4GwMHMJOQ5xsVB20rs2rVjqoLujlOtqbR+GEvpWYI0LgqJ4UyUDmjgXVjXBGB0gsw/Rb/lbVf2/28MARozBAijF+G4D1wQ/tfphxnAKUEo11NWxpHj5ZFGtJ3VjDm44G+esJDntqwZl+EViOMd9fbflILhQd1JIioh/cLMxLrElnxD6DRXRDSHT7Xvib6zff5/imNO7TpDfPnItv5kgq1cU1BdkaZwFqRMKIHRfloxgPrplpfVm/3PRhfop9KQv9yA/mlfbC92xnErbu2ar9iiGnrOsmlSstiP32hFg3PFVXs+AFxQr6Fc7mvmoc0D00mnbgIOmKRLBYyDBPieKOqhkWQ29h+9QXP79w60kjnm/gv0ym9/uVAuns2TX0xmmmB4EIVwvrkoDd4bAODQ9pEo+OhLvVM4P/yb1uiXJ+UxxcHMZovgIHEEn3yDbPkSJ/DzzZI55haZQI7sHPCqtfCdk7yQ3lDmaCrZ2H6SP6LBlqJ/ap08EPoljJIMtKgfEVQUHZpiviAlUq8x2spgT7hcWCf50WgyTONiISNsf7uvDwT3qnU1QsyATqVGGF+lwyw1HASv/KhZwFFTBWkYPsKQXgVac+cuY+47a0Eg0oLB/ti8+HrRVpQ+expPmmMpLAgl0UHD8w== otanfous@gmail.com\r\n    sudo: ALL=(ALL) NOPASSWD:ALL\r\nwrite_files:\r\n  - path: /etc/netplan/00-installer-config.yaml\r\n    content: |\r\n      network:\r\n        version: 2\r\n        ethernets:\r\n          eth0:\r\n            addresses:\r\n              - 192.168.0.200/24\r\n            gateway4: 192.168.0.1\r\n            nameservers:\r\n              addresses: [192.168.0.1]\r\nruncmd:\r\n  - netplan apply\r\n  - systemctl enable qemu-guest-agent\r\n  - systemctl start qemu-guest-agent\r\n  - echo \"master-node\" \u003e /etc/hostname\r\n  - hostnamectl set-hostname master-node\r\n  - sudo snap install microk8s --classic --channel=1.31\r\n  - sudo usermod -a -G microk8s ubuntu\r\n  - sudo chown -R ubuntu ~/.kube\r\n  - sudo microk8s status --wait-ready\r\n  - sudo microk8s enable dns dashboard\r\n  - sudo microk8s config \u003e /home/ubuntu/.kube/config\r\n  - sudo chown ubuntu:ubuntu /home/ubuntu/.kube/config\r\n  - echo \"Master node setup completed\" \u003e /home/ubuntu/master-setup-complete\r\n",
                "file_name": "cloud-config-master.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "cloud_config_worker",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "cloud-config-worker.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/cloud-config-worker.yaml",
            "node_name": "node2",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\r\nchpasswd:\r\n  list: |\r\n    ubuntu:password\r\n  expire: false\r\nhostname: worker_node\r\npackages:\r\n  - qemu-guest-agent\r\n  - openssh-server\r\nusers:\r\n  - default\r\n  - name: ubuntu\r\n    groups: sudo\r\n    shell: /bin/bash\r\n    ssh-authorized-keys:\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDPGGEn2DJJIYmHwEyNaytWGaBsXIHZtOTjev4GwMHMJOQ5xsVB20rs2rVjqoLujlOtqbR+GEvpWYI0LgqJ4UyUDmjgXVjXBGB0gsw/Rb/lbVf2/28MARozBAijF+G4D1wQ/tfphxnAKUEo11NWxpHj5ZFGtJ3VjDm44G+esJDntqwZl+EViOMd9fbflILhQd1JIioh/cLMxLrElnxD6DRXRDSHT7Xvib6zff5/imNO7TpDfPnItv5kgq1cU1BdkaZwFqRMKIHRfloxgPrplpfVm/3PRhfop9KQv9yA/mlfbC92xnErbu2ar9iiGnrOsmlSstiP32hFg3PFVXs+AFxQr6Fc7mvmoc0D00mnbgIOmKRLBYyDBPieKOqhkWQ29h+9QXP79w60kjnm/gv0ym9/uVAuns2TX0xmmmB4EIVwvrkoDd4bAODQ9pEo+OhLvVM4P/yb1uiXJ+UxxcHMZovgIHEEn3yDbPkSJ/DzzZI55haZQI7sHPCqtfCdk7yQ3lDmaCrZ2H6SP6LBlqJ/ap08EPoljJIMtKgfEVQUHZpiviAlUq8x2spgT7hcWCf50WgyTONiISNsf7uvDwT3qnU1QsyATqVGGF+lwyw1HASv/KhZwFFTBWkYPsKQXgVac+cuY+47a0Eg0oLB/ti8+HrRVpQ+expPmmMpLAgl0UHD8w== otanfous@gmail.com\r\n    sudo: ALL=(ALL) NOPASSWD:ALL\r\nwrite_files:\r\n  - path: /etc/netplan/00-installer-config.yaml\r\n    content: |\r\n      network:\r\n        version: 2\r\n        ethernets:\r\n          eth0:\r\n            addresses:\r\n              - 192.168.0.201/24\r\n            gateway4: 192.168.0.1\r\n            nameservers:\r\n              addresses: [192.168.0.1]\r\nruncmd:\r\n  - netplan apply\r\n  - systemctl enable qemu-guest-agent\r\n  - systemctl start qemu-guest-agent\r\n  - echo \"worker-node\" \u003e /etc/hostname\r\n  - hostnamectl set-hostname worker-node\r\n  - sudo snap install microk8s --classic --channel=1.31\r\n  - sudo usermod -a -G microk8s ubuntu\r\n  - sudo chown -R ubuntu ~/.kube\r\n  - sudo microk8s status --wait-ready\r\n  - sudo microk8s enable dns dashboard\r\n  - sudo microk8s config \u003e /home/ubuntu/.kube/config\r\n  - sudo chown ubuntu:ubuntu /home/ubuntu/.kube/config\r\n  - echo \"Worker node setup completed\" \u003e /home/ubuntu/worker-setup-complete\r\n",
                "file_name": "cloud-config-worker.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "master_node",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [
              {
                "enabled": true,
                "timeout": "15m",
                "trim": false,
                "type": "virtio"
              }
            ],
            "audio_device": [],
            "bios": "seabios",
            "boot_order": null,
            "cdrom": [],
            "clone": [],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 2,
                "flags": null,
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "x86-64-v2-AES",
                "units": 1024
              }
            ],
            "description": "MicroK8s Master Node",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "local:iso/jammy-server-cloudimg-amd64.img",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-4320-disk-0",
                "replicate": true,
                "serial": "",
                "size": 32,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "4320",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [],
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.0.200/24",
                        "gateway": "192.168.0.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "upgrade": false,
                "user_account": [],
                "user_data_file_id": "local:snippets/cloud-config-master.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.0.200"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fe80::be24:11ff:fece:bc97"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": "",
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:CE:BC:97"
            ],
            "machine": "",
            "memory": [
              {
                "dedicated": 2048,
                "floating": 2048,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "microk8s-master-node",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:CE:BC:97",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "node2",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": null,
            "protection": false,
            "reboot": false,
            "scsi_hardware": "virtio-scsi-pci",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 1,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "master",
              "microk8s",
              "terraform"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "vm_id": 4320,
            "watchdog": []
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_download_file.ubuntu_cloud_image",
            "proxmox_virtual_environment_file.cloud_config"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "worker_node",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [
              {
                "enabled": true,
                "timeout": "15m",
                "trim": false,
                "type": "virtio"
              }
            ],
            "audio_device": [],
            "bios": "seabios",
            "boot_order": null,
            "cdrom": [],
            "clone": [],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 2,
                "flags": null,
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "x86-64-v2-AES",
                "units": 1024
              }
            ],
            "description": "MicroK8s Worker Node 1",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "local:iso/jammy-server-cloudimg-amd64.img",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-4322-disk-0",
                "replicate": true,
                "serial": "",
                "size": 32,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "4322",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [],
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.0.201/24",
                        "gateway": "192.168.0.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "upgrade": false,
                "user_account": [],
                "user_data_file_id": "local:snippets/cloud-config-worker.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.0.201"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fe80::be24:11ff:fe01:cfb1"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": "",
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:01:CF:B1"
            ],
            "machine": "",
            "memory": [
              {
                "dedicated": 2048,
                "floating": 2048,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "microk8s-worker-node-1",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:01:CF:B1",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "node2",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": null,
            "protection": false,
            "reboot": false,
            "scsi_hardware": "virtio-scsi-pci",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 2,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "microk8s",
              "terraform",
              "worker"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "vm_id": 4322,
            "watchdog": []
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_download_file.ubuntu_cloud_image",
            "proxmox_virtual_environment_file.cloud_config",
            "proxmox_virtual_environment_file.cloud_config_worker",
            "proxmox_virtual_environment_vm.master_node"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
